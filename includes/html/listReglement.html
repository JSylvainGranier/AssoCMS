<h1>Règlements</h1>

<script src="ressources/list.js" ></script>

<style>
input {
	width: inherit !important;
	display: inline-block !important;
}

form {
	display: inline-block;
}

.familleTitre {
	font-weight: bold;
	font-size: 1.1em;
}

.reglementLigne{
	padding-left : 1em;
}

.reglementPerceptionForm{
	text-align: right;
}

.saveSuccess {
	color: #38C74E;
	font-weight: bold;
}

.saveError {
	color: #38C74E;
	font-weight: bold;
}

#reglementsContainer li {
	list-style: none;
	padding : 5px;
}

#reglementsContainer li:nth-child(even) {background: #EDF4F6}
#reglementsContainer li:nth-child(odd) {background: #CADFE6}

.list[searching='true']  .reglementFamilleRappel{
	display: block;
}

.list[searching='false']  .reglementFamilleRappel{
	display: none;
}

.perceptionFiltre {
	display: none;
}

.quickSearchTherm {
	font-style: italic;
	cursor: pointer;
	display: inline-block;
	margin-left: 1em;
}

</style>


<div id="reglementsContainer">

<input class="search" placeholder="Rechercher..." /> 
	<span class="quickSearchTherm" onclick="seachMe(event.target);">Perçu</span> 
	<span class="quickSearchTherm" onclick="seachMe(event.target);">Plus tard</span> 
	<span class="quickSearchTherm" onclick="seachMe(event.target);">À percevoir dès que possible</span>
<ul class="list" searching='false'>
	$reglements$
</ul>
</div>

<script>

var saveReglement = function(form){
	console.log(form);
	
	try{
		var reglementPerception = {
				idReglement : form.querySelector("input[name='idReglement']").value,
				datePerception : form.querySelector("input[name='datePerception']").value,
				refPerception : form.querySelector("input[name='refPerception']").value,
				modePerception : form.querySelector("select[name='modePerception']").value
		}
		
		callServeurPostJson("index.php?saveReglementPerception", function(reponse){
			console.log(reponse);
			
			if(reponse.error){
				document.querySelector("button[ref='"+reponse.idReglement+"']").className += " saveError";
				alert(reponse.error);
			} else {
				document.querySelector("button[ref='"+reponse.idReglement+"']").className += " saveSuccess";
			}
			
			
			
			setTimeout(function(){
				document.querySelector("button[ref='"+reponse.idReglement+"']").className = "";
			}, 2000);
			
					
		}, function(e){
			console.log(e); 
			alert(e);
		
		}, reglementPerception);
		
	} catch (e){
		console.log(e);
	}
	
	
}

var options = {
		  valueNames: [ 'reglementFamilleRappel', 'libelleReglement', 'reglementMontant', 'perceptionFiltre' , {name : 'reglementDatePerception', attr : 'value'} ,{ name: 'reglementRefPerception', attr: 'value' }]
		};

var onSearchChangeView = function() {
	var searchLength = document.querySelector(".search").value.length
	document.querySelector(".list").setAttribute("searching", searchLength > 0 ? "true" : "false");
}

var rlgList = new List('reglementsContainer', options);
rlgList.on("searchComplete", onSearchChangeView);
rlgList.on("searchStart", onSearchChangeView);

var seachMe = function(span){
	document.querySelector(".search").value = span.innerHTML;
	document.querySelector(".search").dispatchEvent(new Event("keyup"));
}

</script>